# üöÄ –ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ API

## üìã –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### 1. ‚úÖ **Photo —Å–ª–∞–π–¥ —Ç–µ–ø–µ—Ä—å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –ø–æ–ª–µ–π
- –£–ª—É—á—à–µ–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ —Å SVG
- –í –ª–æ–≥–∞—Ö —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ –∫–∞–∫–∏–µ –ø–æ–ª—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∏ –ø–æ—á–µ–º—É –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç

### 2. ‚úÖ **–ü—Ä–µ–≤—å—é —à–∞–±–ª–æ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç**
- PNG –ø—Ä–µ–≤—å—é –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Playwright
- Fallback —á–µ—Ä–µ–∑ PIL –µ—Å–ª–∏ Playwright –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- API: `GET /api/templates/all-previews` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `preview_url`

### 3. ‚úÖ **PNG –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ø–æ—Å–ª–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏**
- –ù–æ–≤—ã–π API endpoint –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ SVG ‚Üí PNG
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Playwright –∏ PIL fallback
- –ó–∞–≥—Ä—É–∑–∫–∞ PNG –≤ Supabase

---

## üîå **–ù–æ–≤—ã–π API: PNG –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è**

### Endpoint:
```
POST /api/convert-to-png
```

### –ó–∞–ø—Ä–æ—Å:
```json
{
  "svg_url": "https://vahgmyuowsilbxqdjjii.supabase.co/storage/v1/object/public/carousel-assets/carousel/file.svg"
}
```

### –û—Ç–≤–µ—Ç:
```json
{
  "success": true,
  "png_url": "https://vahgmyuowsilbxqdjjii.supabase.co/storage/v1/object/public/carousel-assets/converted/file.png",
  "filename": "converted_abc123.png"
}
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
1. –ì–µ–Ω–µ—Ä–∏—Ä—É–π –∫–∞—Ä—É—Å–µ–ª—å —á–µ—Ä–µ–∑ `POST /api/generate/carousel`
2. –ü–æ–ª—É—á–∏ SVG URL –∏–∑ –æ—Ç–≤–µ—Ç–∞
3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–π –≤ PNG —á–µ—Ä–µ–∑ `POST /api/convert-to-png`
4. –ò—Å–ø–æ–ª—å–∑—É–π PNG URL –¥–ª—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

---

## üñºÔ∏è **–ü—Ä–µ–≤—å—é —à–∞–±–ª–æ–Ω–æ–≤**

### API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞:
```
GET /api/templates/all-previews
```

### –û—Ç–≤–µ—Ç:
```json
{
  "templates": [
    {
      "id": "template-id",
      "name": "Template Name",
      "category": "open-house",
      "template_role": "main",
      "preview_url": "/output/previews/template-id_preview.png"
    }
  ]
}
```

### API –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–µ–≤—å—é:
```
GET /api/templates/{template_id}/preview
```
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç PNG –∏–ª–∏ SVG –ø—Ä–µ–≤—å—é –Ω–∞–ø—Ä—è–º—É—é.

---

## üé† **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—É—Å–µ–ª–∏ (—É–ª—É—á—à–µ–Ω–∞)**

### Endpoint –æ—Å—Ç–∞–ª—Å—è —Ç–æ—Ç –∂–µ:
```
POST /api/generate/carousel
```

### –ù–æ —Ç–µ–ø–µ—Ä—å:
- ‚úÖ **Photo —Å–ª–∞–π–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **URL –≤–∞–ª–∏–¥–Ω—ã–µ** (–±–µ–∑ –ª–∏—à–Ω–µ–≥–æ `?`)
- ‚úÖ **–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ª–æ–≥–∏** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π** –≤–∫–ª—é—á–∞—è `dyno.propertyimage2`

---

## üîç **–û—Ç–ª–∞–¥–∫–∞ Photo —Å–ª–∞–π–¥–∞**

–í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ —Ç–µ–ø–µ—Ä—å –≤–∏–¥–Ω–æ:

```
üîç –í–°–ï –ø–æ–ª—è –≤ photo SVG:
   - dyno.propertyimage2
   - dyno.propertyaddress

üîç –ü–æ–ª—è –æ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:
   - dyno.propertyimage = https://...
   - dyno.propertyimage2 = https://...
   - dyno.price = $500,000

üîç Replacements –¥–ª—è photo SVG: {'dyno.propertyimage2': 'https://...'}
```

–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–Ω—è—Ç—å –ø–æ—á–µ–º—É –ø–æ–ª—è –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.

---

## üß™ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**

–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π:
```bash
python3 test_all_fixes.py
```

–¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –ü—Ä–µ–≤—å—é —à–∞–±–ª–æ–Ω–æ–≤
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–∞—Ä—É—Å–µ–ª–∏
- ‚úÖ PNG –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤—Å–µ—Ö URL

---

## üìä **–°—Ç–∞—Ç—É—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

| –ü—Ä–æ–±–ª–µ–º–∞ | –°—Ç–∞—Ç—É—Å | –†–µ—à–µ–Ω–∏–µ |
|----------|--------|---------|
| Photo —Å–ª–∞–π–¥ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–ª—É—á—à–µ–Ω–∞ –æ—Ç–ª–∞–¥–∫–∞ –ø–æ–ª–µ–π |
| –ü—Ä–µ–≤—å—é —à–∞–±–ª–æ–Ω–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | Playwright + PIL fallback |
| –ù—É–∂–Ω–∞ PNG –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è | ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ | –ù–æ–≤—ã–π API endpoint |
| Invalid URL –æ—à–∏–±–∫–∏ | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –£–±—Ä–∞–Ω –ª–∏—à–Ω–∏–π `?` |
| IndentationError –Ω–∞ Render | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ | –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω |

**–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Ä–µ—à–µ–Ω—ã!** üéâ