# üñºÔ∏è –°–ò–°–¢–ï–ú–ê –ó–ê–ú–ï–ù–´ –ò–ó–û–ë–†–ê–ñ–ï–ù–ò–ô –í SVG

## üìã –û–±–∑–æ—Ä

–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∑–∞–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ SVG —Ñ–∞–π–ª–∞—Ö —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- ‚úÖ **URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ base64)
- ‚úÖ **Base64 –¥–∞–Ω–Ω—ã—Ö** (–ø—Ä—è–º–∞—è –∑–∞–º–µ–Ω–∞)
- ‚úÖ **Fallback —Å–∏—Å—Ç–µ–º—ã** –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ **Pattern ‚Üí Image —Å–≤—è–∑–∏** (—Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ SVG)
- ‚úÖ **–ü—Ä—è–º—ã–µ –∑–∞–º–µ–Ω—ã** (–ø—Ä–æ—Å—Ç—ã–µ —Å–ª—É—á–∞–∏)
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

### `replace_image_in_svg(svg_content, field_name, new_image_url)`
–ó–∞–º–µ–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ SVG —Ñ–∞–π–ª–µ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `svg_content` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ SVG —Ñ–∞–π–ª–∞
- `field_name` - –∏–º—è –ø–æ–ª—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'dyno.propertyimage')
- `new_image_url` - URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–ª–∏ base64 –¥–∞–Ω–Ω—ã–µ

**–ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã:**
1. –ò—â–µ—Ç –ø—Ä—è–º–æ–π —ç–ª–µ–º–µ–Ω—Ç —Å `id=field_name`
2. –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—â–µ—Ç —á–µ—Ä–µ–∑ pattern —Å–≤—è–∑–∏:
   - –ù–∞—Ö–æ–¥–∏—Ç —ç–ª–µ–º–µ–Ω—Ç —Å `id` —Å–æ–¥–µ—Ä–∂–∞—â–∏–º `field_name`
   - –ò–∑–≤–ª–µ–∫–∞–µ—Ç `pattern_id` –∏–∑ `fill="url(#pattern_id)"`
   - –ù–∞—Ö–æ–¥–∏—Ç pattern –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç `image_id` –∏–∑ `<use xlink:href="#image_id">`
   - –ó–∞–º–µ–Ω—è–µ—Ç `xlink:href` –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º `<image>` —ç–ª–µ–º–µ–Ω—Ç–µ

### `process_image_replacements(svg_content, image_data)`
–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–º–µ–Ω—É –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ SVG.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `svg_content` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ SVG —Ñ–∞–π–ª–∞
- `image_data` - —Å–ª–æ–≤–∞—Ä—å `{field_name: image_url}`

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º:
- `image`, `photo`, `picture`, `logo`, `headshot`

### `download_and_convert_image(url, timeout=10, retries=3)`
–°–∫–∞—á–∏–≤–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ URL –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ base64.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- **3 –ø–æ–ø—ã—Ç–∫–∏** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ URL
- **Fallback —Å–µ—Ä–≤–∏—Å—ã** –¥–ª—è placeholder'–æ–≤:
  - `picsum.photos` (Lorem Picsum)
  - `dummyimage.com` (DummyImage)  
  - `fakeimg.pl` (FakeImg)
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ** placeholder'–æ–≤ –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –æ—Ç–∫–∞–∑–µ —Å–µ—Ä–≤–∏—Å–æ–≤

### `create_placeholder_image(width, height, color, text)`
–°–æ–∑–¥–∞–µ—Ç placeholder –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ —Å —Ç–µ–∫—Å—Ç–æ–º.

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:

1. **‚úÖ main.svg** - —Å–ª–æ–∂–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å pattern ‚Üí image —Å–≤—è–∑—è–º–∏:
   - `dyno.propertyimage` ‚Üí `pattern0_294_4` ‚Üí `image0_294_4`
   - `dyno.logo` ‚Üí `pattern1_294_4` ‚Üí `image1_294_4`
   - `dyno.agentheadshot` ‚Üí `pattern2_294_4` ‚Üí `image2_294_4`

2. **‚úÖ photo.svg** - –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
   - `dyno.propertyimage2` ‚Üí `pattern0_332_4` ‚Üí `image0_332_4`

3. **‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
   - –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã (via.placeholder.com)
   - DNS –æ—à–∏–±–∫–∏
   - Timeout'—ã —Å–µ—Ç–∏
   - –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```
üß™ –¢–ï–°–¢: main.svg
- –ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5,735,360 —Å–∏–º–≤–æ–ª–æ–≤
- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 343,513 —Å–∏–º–≤–æ–ª–æ–≤  
- –≠–∫–æ–Ω–æ–º–∏—è: -5,391,847 —Å–∏–º–≤–æ–ª–æ–≤ (94% —É–º–µ–Ω—å—à–µ–Ω–∏–µ!)
- –ó–∞–º–µ–Ω–µ–Ω–æ: 3/3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚úÖ

üß™ –¢–ï–°–¢: photo.svg  
- –ò—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 1,356,464 —Å–∏–º–≤–æ–ª–æ–≤
- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 4,876 —Å–∏–º–≤–æ–ª–æ–≤
- –≠–∫–æ–Ω–æ–º–∏—è: -1,351,588 —Å–∏–º–≤–æ–ª–æ–≤ (99.6% —É–º–µ–Ω—å—à–µ–Ω–∏–µ!)
- –ó–∞–º–µ–Ω–µ–Ω–æ: 1/1 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚úÖ
```

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í preview_system.py:

```python
# –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è create_preview_with_data
def create_preview_with_data(svg_content, replacements, preview_type='png'):
    # 1. –°–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    processed_svg = process_image_replacements(svg_content, replacements)
    
    # 2. –ó–∞—Ç–µ–º –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
    processed_svg = process_svg_font_perfect(processed_svg, replacements)
    
    # 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–µ–≤—å—é
    return generate_svg_preview(processed_svg, preview_type)
```

### –í app.py (Flask API):

```python
@app.route('/api/preview', methods=['POST'])
def generate_preview():
    data = request.json
    svg_content = data.get('svg')
    replacements = data.get('data', {})
    
    # –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    result = create_preview_with_data(svg_content, replacements)
    return jsonify(result)
```

## üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã

### –í—Ö–æ–¥–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
- ‚úÖ **HTTP/HTTPS URL** (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è)
- ‚úÖ **Base64 –¥–∞–Ω–Ω—ã–µ** (–ø—Ä—è–º–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- ‚úÖ **–õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã** (—á–µ—Ä–µ–∑ file://)

### –í—ã—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:
- ‚úÖ **Base64 JPEG** (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, quality=85)
- ‚úÖ **RGB –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è** (–∏–∑ RGBA, LA, P)

### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:
- ‚úÖ **Unsplash** (images.unsplash.com)
- ‚úÖ **Lorem Picsum** (picsum.photos) 
- ‚úÖ **DummyImage** (dummyimage.com)
- ‚úÖ **FakeImg** (fakeimg.pl)
- ‚ö†Ô∏è **via.placeholder.com** (—á–∞—Å—Ç–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –µ—Å—Ç—å fallback)

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã:
```
üñºÔ∏è –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: dyno.propertyimage
üîç –ò—â—É —á–µ—Ä–µ–∑ pattern –¥–ª—è –ø–æ–ª—è: dyno.propertyimage  
‚úÖ –ù–∞–π–¥–µ–Ω pattern: pattern0_294_4
‚úÖ –ù–∞–π–¥–µ–Ω image ID: image0_294_4
üì• –ü–æ–ø—ã—Ç–∫–∞ 1/3: https://images.unsplash.com/...
‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–∫–∞—á–∞–Ω–æ –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ (332111 —Å–∏–º–≤–æ–ª–æ–≤)
‚úÖ –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ dyno.propertyimage —É—Å–ø–µ—à–Ω–æ –∑–∞–º–µ–Ω–µ–Ω–æ!
```

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:

1. **DNS –æ—à–∏–±–∫–∞**: `Failed to resolve 'via.placeholder.com'`
   - **–†–µ—à–µ–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

2. **Timeout**: `Max retries exceeded`
   - **–†–µ—à–µ–Ω–∏–µ**: 3 –ø–æ–ø—ã—Ç–∫–∏ + fallback –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã

3. **–ü–æ–ª–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ**: `–≠–ª–µ–º–µ–Ω—Ç —Å id —Å–æ–¥–µ—Ä–∂–∞—â–∏–º field_name –Ω–µ –Ω–∞–π–¥–µ–Ω`
   - **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ –ø–æ–ª—è –≤ SVG

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥. –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

- **–í—ã—Å–æ–∫—É—é –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã
- **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —Ä–∞–∑–º–µ—Ä–∞** —Ñ–∞–π–ª–æ–≤ (–¥–æ 99% —É–º–µ–Ω—å—à–µ–Ω–∏–µ)
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** –¥–ª—è –ª—é–±—ã—Ö SVG —Å—Ç—Ä—É–∫—Ç—É—Ä
- **–ü—Ä–æ—Å—Ç–æ—Ç—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π API

**–ì–æ—Ç–æ–≤–æ –∫ –∫–æ–º–º–∏—Ç—É!** üöÄ